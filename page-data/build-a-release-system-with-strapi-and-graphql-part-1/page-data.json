{"componentChunkName":"component---src-templates-blog-post-js","path":"/build-a-release-system-with-strapi-and-graphql-part-1/","result":{"data":{"site":{"siteMetadata":{"title":"ryz"}},"markdownRemark":{"id":"10beb585-1d2a-50fe-90f7-7cc4fe69de9e","excerpt":"软件开发的工作中不可避免的会遇到突发的生产环境事故，尤其是微服务架构下的今天，当一场事故发生后，如何快速定位到问题根源就极为重要。 于是一个想法顺势而生：在 Jenkins（或其他 CI/CD…","html":"<p>软件开发的工作中不可避免的会遇到突发的生产环境事故，尤其是微服务架构下的今天，当一场事故发生后，如何快速定位到问题根源就极为重要。</p>\n<p>于是一个想法顺势而生：在 Jenkins（或其他 CI/CD 系统）中自动记录所有项目的发布变更和变更详细内容，并能按时间、按项目、按团队进行筛选。</p>\n<p>做个网站对于程序员来说并没有什么难度，但是平时工作那么多，如何<strong>快速</strong>实现这个想法就变得尤其重要。</p>\n<p><strong>于是就有了今天要分享的内容</strong></p>\n<blockquote>\n<p>使用 Strapi 构建 GraphQL API，配合上 React.js，Typescript 和 GraphQL codegen 来快速构建一个发布变更系统。</p>\n</blockquote>\n<h2>Strapi</h2>\n<p>这里着重介绍一下 Strapi，（官网地址：<a href=\"https://strapi.io\">https://strapi.io</a> ）是一个开源的 Node.js Headless CMS，可以通过 UI 界面去定义模型关系来自动生成数据库、RESTful API、GraphQL API 和 swagger API 文档。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e96e52a24a217a21b67c43f139bc633c/a2510/1590217476809.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUCAwb/xAAWAQEBAQAAAAAAAAAAAAAAAAADAAH/2gAMAwEAAhADEAAAAV1rJo+Z0mLf/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAIBAwQREjP/2gAIAQEAAQUCWNkHezCqR6YrRTL9/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAYEQEBAAMAAAAAAAAAAAAAAAABAAMRIf/aAAgBAgEBPwFyaYeX/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECETEQIv/aAAgBAQAGPwLGy85copuzzFIZ/8QAGxABAAICAwAAAAAAAAAAAAAAAQARIUFxobH/2gAIAQEAAT8hqdSBRAA1LZLGlvS0mf4Ynjn/2gAMAwEAAgADAAAAEG//AP/EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxCRr//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxAGMtg3/8QAHBABAQADAAMBAAAAAAAAAAAAAREAITFBUXHR/9oACAEBAAE/ECgoWfnmUXRstA8TJdp98wPokayGs2BZKJhCYGuPhn//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi.io website\"\n        title=\"Strapi.io website\"\n        src=\"/static/e96e52a24a217a21b67c43f139bc633c/1c72d/1590217476809.jpg\"\n        srcset=\"/static/e96e52a24a217a21b67c43f139bc633c/a80bd/1590217476809.jpg 148w,\n/static/e96e52a24a217a21b67c43f139bc633c/1c91a/1590217476809.jpg 295w,\n/static/e96e52a24a217a21b67c43f139bc633c/1c72d/1590217476809.jpg 590w,\n/static/e96e52a24a217a21b67c43f139bc633c/a8a14/1590217476809.jpg 885w,\n/static/e96e52a24a217a21b67c43f139bc633c/a2510/1590217476809.jpg 1000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>近几年 headless CMS 的概念很火，其实 headless 字面意思是“无头的”，这里理解为不提供前端界面的 CMS 系统，只提供 API 接口。多样化的客户端撼动了传统 CMS（如 WordPress）的地位，APP、小程序、H5 的爆发，加速了前后端技术的相互独立。</p>\n<p>提到 Headless CMS，还有一个不错的选项是 contentful，可以理解为上了云的 Strapi。而另一个有着相似概念的（通过 schema 生成 API）由 IBM 开源的 node.js API 框架 loopback，都是不错的可选性。</p>\n<p>为什么偏偏选了 Strapi？以下是 Strapi 与 contentful，loopback 的对比。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Strapi</th>\n<th>contenful</th>\n<th>loopback</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>self-hosted</td>\n<td>✅</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n<tr>\n<td>可视化管理界面</td>\n<td>✅</td>\n<td>✅</td>\n<td>❌</td>\n</tr>\n<tr>\n<td>定制能力强的插件系统</td>\n<td>✅</td>\n<td>❌</td>\n<td>✅</td>\n</tr>\n</tbody>\n</table>\n<p>在前后端分离的大环境下，Strapi 可以让（前端）工程师快速完成一套「功能完整」且「性能强大」的 API，并可以部署在自己的服务器上，使得这个方案脱颖而出。也是半个小时完成 API 接口的必要条件。</p>\n<h2>安装 Strapi cli</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> create strapi-app my-project --quickstart</code></pre></div>\n<h2>画模型关系图</h2>\n<p>在等待安装的过程中，我们可以先构思一下将要构建的系统模型关系。</p>\n<p>以我做的版本发布记录系统为例，这个系统主要用来记录版本发布，版本发布中我需要知道它属于那个项目以及发布的版本号、发布时间、发布内容（release note）等信息。</p>\n<p>简单画个图，将就看一下。</p>\n<p>￼￼<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/faa10059c60dad3057c29b987fd418bb/8efc2/release_system_prototype.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC0klEQVQ4y52TzXKjOBSFef9lv5DjxbhSnRR27LSNCYQQQAIkhP4ljA1ToNiVdE96Md+CkqAO996jIw8AQAhBCMEZMAM/UZZlVVVJHKO6llIqpTjnCKEsyzwI4fg9wzCM42iMSX/+ZAgdw9D3/f1+XxQFhNDLsqyu62qmvOIKfuYtjgEASZKEYZimaZ7nAAAPAGCMUUoxxqSUWmsppTGGMaa1Nle608laezqd+r7vZgghHkJIKXV/f79cLl9eXsIwDIJgtVrtdtvz+fyXiSilHsaYEJKmaVEUdV0DABBC71nmrzdKqdvYf4IxnsSccyG4mpjadn4eDoHW+i/iqqo8hPDlcpFSGd0xxtorUkp6xb1hM0IIY8w4jpPbhBApZJwGkMQNwYIL9wtKqRDiJmCMNTNCCIyx1rosS69tW63182FziJ6kFEVRAACstXVdv76+lmVJKU3TFCF0G4FzLqX8EFtrgyDYbZ8hhO4Yq6qK4zgMwzzPkyR5enqKoogQ4oqXZXk6naa227YdhmG4DOf+opSy1jjPjDHWWqWU1rrrOmOMS4E79mEYJjHjzBiTZMc3cMQNIuTDm7ZtCSHOMIwxQshttdZu5sltIbgx9h28Ullzzqy1jE/ecM5dzgghfd9/jrrry4mFtfYYhMdjuFwufd/fbreLxeLh4eHx8XGxWNzd3e33e4RQVVWEEM45hNBaO4kppf95k35bXL4yjuPktjvG58M2So5FXhRFnuf5+0yWZbdFnk/f3E2MokhKOcWTMcooy2B8HvU4jN9k8UtTTdO42H2EZL3e7Hb7MnspH34kcfTParX/NbFerzebje/7cRxba6WUXddVVeUyN12Mvu8xxrAsW4IJfIOwdHcdAOBadVsy07Zt0zR9309il7v/QdM0U2XxCX7llpOmaeaSjVu72HDO6rr2hmHov+F8PiutESYNoS3llHJCKGlZMz+t7f4FJGQISjy9dBgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"excalidraw Release system prototype\"\n        title=\"excalidraw Release system prototype\"\n        src=\"/static/faa10059c60dad3057c29b987fd418bb/fcda8/release_system_prototype.png\"\n        srcset=\"/static/faa10059c60dad3057c29b987fd418bb/12f09/release_system_prototype.png 148w,\n/static/faa10059c60dad3057c29b987fd418bb/e4a3f/release_system_prototype.png 295w,\n/static/faa10059c60dad3057c29b987fd418bb/fcda8/release_system_prototype.png 590w,\n/static/faa10059c60dad3057c29b987fd418bb/8efc2/release_system_prototype.png 828w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>于是模型关系便不难做出来：</p>\n<p>￼￼￼<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 508px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b1a6cfde005d5373593a60fd4fd1f6a6/2fd48/1_to_n_relation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 178.3783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD80lEQVRIx52WV0/sSBCF/c/5Azwg8QYiPABCAiEeyIicc845h8nJnmGAs/rqqkfGd2aW3ZZKdtvt6lNVp07bk6REIqG7uzvlcjm9vb3p9fVVLy8venp60vn5uW5vb82+v79Vb/De46anp0cNDQ3q7e1VZ2enxsfH1d3drYWFBa2urmpgYEDDw8O24cfHh0ql0g8rFosKgsCceul0WhMTE+a0vb1dra2tamtrU3Nzs7q6ujQ6OmrXlpYWXV9f6/LyUldXV3Z/c3NjRnSnp6dKJpPyYrHYv4bymwHC5+dneXhNpVKanZ3V1NSUdnd3bUG5XNbn56e+vr4q924OgLAxCJ28G0I+YDw+Phr83wznKOyQYnpUuFAoaGdnRzMzM9rf39fe3p7W1tYsX6Df3NzU+vq6PVtZWTGkzplzSLEA58XjcYv/4uJC29vb9vHR0ZE2NjZ0fHxsBTg8PDTkzBcXFysVrerw/f29Un54xwsMFNCERDPy+XzFUa2Q4bDlkMUUpK+vT4ODg0YVrtAFLoJwZGTEqMGgMFGEOLQq4xVE4YXh4SrsRnSNcwi5idAcgpCO6O/vty5ZWlqyAoFybm7O8ke3uPCr0abikFIzIXTYTxFwQIXPzs5sEY5OTk50f3//A1V4wBTj4cPDg3zf/3VHOGJzdcaAXhTYqgyScH+CkN0gOldnREOK+AZjTgSAOjg4ELrgVesAdnUdMz8/bx8zKE44b9FvTL6qJZgi0RHwbmxszEgfzV30Gze8MEGji0g0wlqrutXMq9X0jnuoEaStVd3o8GopiLsHHSmIPq/rsBp0RwdCpqer9e9/cuhChkqQvl4h/ipKvQXwEtkK93stqxQFBPTy8vKy6SEkRRsJl75GdFGcXxWFRUNDQ2pqajKJ4hhtbGxUR0eHtra2zOhrRAL5cscERm/TJTyjY7LZrDxQgIrDCQJzFKCBzDGQghgFp/1QeCJyxpw+5h2p8ehh1IYiuEP8/wy+4y/DAy6G/nGUooGcG47cLtmuj5lHj1PXVYiMR+yu+cO7RSUr3D3RfmYggeaQTgAh6PglmZ6eNkFAHJhzvpBD1rFmcnLSVJ1jNbxZxSEI0TXODnLpQkJpuKeSvGdTOobqUgRCDHfND4eIJh1BlagmycU5sg9tHKmrCclfOWRnHGYyGQsJh6BgAxaA5k8BpO86fRwUi38cOnSQEqnCMVKO+X5B6XTKNnQ/oGzmfkDDv3NEYw7ZkfiBzBUjf7FEUql0RrF4UkFQVCqTVTKVVjaXUzyRVDqTVSKZ0tPLm95jccXiCUuTV4uo+YKvTC6vdDanoFhSwQ/MSqUP5fIF5fK+zVnnB0Xl/UDl8qf+AYhJn93Qyo8/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"excalidraw Model relation\"\n        title=\"excalidraw Model relation\"\n        src=\"/static/b1a6cfde005d5373593a60fd4fd1f6a6/2fd48/1_to_n_relation.png\"\n        srcset=\"/static/b1a6cfde005d5373593a60fd4fd1f6a6/12f09/1_to_n_relation.png 148w,\n/static/b1a6cfde005d5373593a60fd4fd1f6a6/e4a3f/1_to_n_relation.png 295w,\n/static/b1a6cfde005d5373593a60fd4fd1f6a6/2fd48/1_to_n_relation.png 508w\"\n        sizes=\"(max-width: 508px) 100vw, 508px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>虽然最终的系统比这个模型图要复杂很多，但是用于教程已经足够了。</p>\n<p>（画图工具是一个开源的免费的网站：<a href=\"https://excalidraw.com/\">https://excalidraw.com/</a> 用的是端到端加密，非常安全，同时也支持多人协同编辑哦~）</p>\n<h2>创建 Content type</h2>\n<p>有了这个模型关系，你就可以开始用 Strapi 搭建 schema 了。Strapi 目前支持 mongodb，sqlite，mysql 和 postgresql。本地开发默认使用 sqlite，所以也不用安装其他的数据库依赖。</p>\n<p>安装好 Strapi 项目后，进入项目根目录，执行 yarn start，服务器默认端口是 1337，打开浏览器访问 <a href=\"http://localhost:1337/admin\">http://localhost:1337/admin</a> 并创建一个管理员用户。进入后台后直接开始创建 content type。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/69128/123.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYBBAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHNZlVoRtkBX//EABoQAAICAwAAAAAAAAAAAAAAAAABAhMDBDT/2gAIAQEAAQUCsmYG6Bmvzn//xAAWEQEBAQAAAAAAAAAAAAAAAAABEDH/2gAIAQMBAT8BAMn/xAAXEQEAAwAAAAAAAAAAAAAAAAABAhAx/9oACAECAQE/AWS7X//EABgQAAIDAAAAAAAAAAAAAAAAABBxAAID/9oACAEBAAY/ApRHND//xAAaEAEBAAIDAAAAAAAAAAAAAAABABExUYGh/9oACAEBAAE/IcBvycvJstpA6MX/2gAMAwEAAgADAAAAENwP/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxA5iL//xAAXEQADAQAAAAAAAAAAAAAAAAABEBEh/9oACAECAQE/EBGqv//EABsQAQACAgMAAAAAAAAAAAAAAAEAERAhMVGR/9oACAEBAAE/ELg0HnWMotUuJNNvscjd9zBRRP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi New content type\"\n        title=\"Strapi New content type\"\n        src=\"/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/1c72d/123.jpg\"\n        srcset=\"/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/a80bd/123.jpg 148w,\n/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/1c91a/123.jpg 295w,\n/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/1c72d/123.jpg 590w,\n/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/a8a14/123.jpg 885w,\n/static/7da37a5ac0e8d9de4a80f3de9dadd4d4/69128/123.jpg 1036w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>现在开始定义 releaselog 的字段。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf9925044760aeab12e2b6ca5ef45530/0e355/1590076404751.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdywSD//xAAXEAADAQAAAAAAAAAAAAAAAAAAARBB/9oACAEBAAEFAlUaf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABcQAAMBAAAAAAAAAAAAAAAAAAAQQTH/2gAIAQEAAT8hFWCl/9oADAMBAAIAAwAAABCDz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQABBAMAAAAAAAAAAAAAAAERABAhMUFhsf/aAAgBAQABPxAKb5qWZhjq2Ao8Lf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi releaselog content type\"\n        title=\"Strapi releaselog content type\"\n        src=\"/static/cf9925044760aeab12e2b6ca5ef45530/1c72d/1590076404751.jpg\"\n        srcset=\"/static/cf9925044760aeab12e2b6ca5ef45530/a80bd/1590076404751.jpg 148w,\n/static/cf9925044760aeab12e2b6ca5ef45530/1c91a/1590076404751.jpg 295w,\n/static/cf9925044760aeab12e2b6ca5ef45530/1c72d/1590076404751.jpg 590w,\n/static/cf9925044760aeab12e2b6ca5ef45530/a8a14/1590076404751.jpg 885w,\n/static/cf9925044760aeab12e2b6ca5ef45530/fbd2c/1590076404751.jpg 1180w,\n/static/cf9925044760aeab12e2b6ca5ef45530/0e355/1590076404751.jpg 1798w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>这里要着重介绍一下「引用」类型的字段，也就是 releaselog 里面的 <code class=\"language-text\">approved_by</code> (表示发布 releaselog 的负责人)，用来对应 Strapi 原生集成的 User 类型。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94a58c3b52d00ff029d54e0cf02d2d58/5fe1b/1590077020351.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAHuzVQPMRpP/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAIBIDH/2gAIAQEAAQUCij4p/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQMBAT8BU//EABcRAQADAAAAAAAAAAAAAAAAAAABEiH/2gAIAQIBAT8BnFX/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAACAgMAAAAAAAAAAAAAAAAAATFxEBFh/9oACAEBAAE/IRsT6sRWQdn/2gAMAwEAAgADAAAAENzP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARQf/aAAgBAwEBPxBY1y//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAECAQE/EGijl6f/xAAfEAACAQIHAAAAAAAAAAAAAAABEQAQITFBUWFxwfD/2gAIAQEAAT8QsYSGV4Q0XMAuyDCezamf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi approved_by field definition\"\n        title=\"Strapi approved_by field definition\"\n        src=\"/static/94a58c3b52d00ff029d54e0cf02d2d58/1c72d/1590077020351.jpg\"\n        srcset=\"/static/94a58c3b52d00ff029d54e0cf02d2d58/a80bd/1590077020351.jpg 148w,\n/static/94a58c3b52d00ff029d54e0cf02d2d58/1c91a/1590077020351.jpg 295w,\n/static/94a58c3b52d00ff029d54e0cf02d2d58/1c72d/1590077020351.jpg 590w,\n/static/94a58c3b52d00ff029d54e0cf02d2d58/a8a14/1590077020351.jpg 885w,\n/static/94a58c3b52d00ff029d54e0cf02d2d58/fbd2c/1590077020351.jpg 1180w,\n/static/94a58c3b52d00ff029d54e0cf02d2d58/5fe1b/1590077020351.jpg 1796w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>然后在完成所有的字段定义后，就可以点击右上角的保存了。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/257be69bac0b841f710d33ae5c9e4250/7e1b6/1590077345813.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHuoSND/8QAFxABAQEBAAAAAAAAAAAAAAAAAQACIP/aAAgBAQABBQImM8f/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRABAQEBAQEAAAAAAAAAAAAAAQARgSEx/9oACAEBAAE/IQQUQzsQehy+Wu23/9oADAMBAAIAAwAAABDf3//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPxCpj//EABYRAQEBAAAAAAAAAAAAAAAAAAARUf/aAAgBAgEBPxCIx//EABsQAQADAQADAAAAAAAAAAAAAAEAESFBMZGx/9oACAEBAAE/EBLRWxkQpwspbW+EPsLuj5b2GzPUFP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi releaselog fields\"\n        title=\"Strapi releaselog fields\"\n        src=\"/static/257be69bac0b841f710d33ae5c9e4250/1c72d/1590077345813.jpg\"\n        srcset=\"/static/257be69bac0b841f710d33ae5c9e4250/a80bd/1590077345813.jpg 148w,\n/static/257be69bac0b841f710d33ae5c9e4250/1c91a/1590077345813.jpg 295w,\n/static/257be69bac0b841f710d33ae5c9e4250/1c72d/1590077345813.jpg 590w,\n/static/257be69bac0b841f710d33ae5c9e4250/a8a14/1590077345813.jpg 885w,\n/static/257be69bac0b841f710d33ae5c9e4250/fbd2c/1590077345813.jpg 1180w,\n/static/257be69bac0b841f710d33ae5c9e4250/7e1b6/1590077345813.jpg 1310w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>每次保存 content type 的时候，Strapi 会自动重启，并在项目中生成对于的 model，controller 文件，创建或更新数据库表结构。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/04aefb827c81d458620d82ed5e57044a/e1596/1590077696434.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB7WWiRQj/xAAZEAADAQEBAAAAAAAAAAAAAAAAARECEBL/2gAIAQEAAQUCnNN30i5Lk//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAQEBAAAAAAAAAAAAAAAAABAxAP/aAAgBAQAGPwJup//EAB4QAAICAAcAAAAAAAAAAAAAAAABESEQMUFRgZHh/9oACAEBAAE/IeEDrIUo9MNN4Huro//aAAwDAQACAAMAAAAQ4C//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QRsb/xAAeEAEAAgIBBQAAAAAAAAAAAAABABEh0YExQXGR4f/aAAgBAQABPxA6rOCErQOIaKjLAQXs9Oo/dalnLeVqf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi auto generated files\"\n        title=\"Strapi auto generated files\"\n        src=\"/static/04aefb827c81d458620d82ed5e57044a/1c72d/1590077696434.jpg\"\n        srcset=\"/static/04aefb827c81d458620d82ed5e57044a/a80bd/1590077696434.jpg 148w,\n/static/04aefb827c81d458620d82ed5e57044a/1c91a/1590077696434.jpg 295w,\n/static/04aefb827c81d458620d82ed5e57044a/1c72d/1590077696434.jpg 590w,\n/static/04aefb827c81d458620d82ed5e57044a/a8a14/1590077696434.jpg 885w,\n/static/04aefb827c81d458620d82ed5e57044a/fbd2c/1590077696434.jpg 1180w,\n/static/04aefb827c81d458620d82ed5e57044a/e1596/1590077696434.jpg 2048w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>接着完成 project 的字段定义，这里要加上对 releaselog 的「引用」类型。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e8786a8ec45dac96575fedfca270f48/5fe1b/1590077909226.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAd4ioHlE0n//xAAYEAACAwAAAAAAAAAAAAAAAAAAAQIgMf/aAAgBAQABBQKk8R//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEv/aAAgBAwEBPwFT/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAESIf/aAAgBAgEBPwGcUf/EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABsQAAICAwEAAAAAAAAAAAAAAAABMXEQESFh/9oACAEBAAE/IVw2J+rEdkXZ/9oADAMBAAIAAwAAABBc7//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEWH/2gAIAQMBAT8QXI5v/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERYf/aAAgBAgEBPxBoo9H/xAAbEAACAgMBAAAAAAAAAAAAAAABEQAxECFxQf/aAAgBAQABPxAR4ERUuwC2zsFZiP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi releaselog project relation\"\n        title=\"Strapi releaselog project relation\"\n        src=\"/static/3e8786a8ec45dac96575fedfca270f48/1c72d/1590077909226.jpg\"\n        srcset=\"/static/3e8786a8ec45dac96575fedfca270f48/a80bd/1590077909226.jpg 148w,\n/static/3e8786a8ec45dac96575fedfca270f48/1c91a/1590077909226.jpg 295w,\n/static/3e8786a8ec45dac96575fedfca270f48/1c72d/1590077909226.jpg 590w,\n/static/3e8786a8ec45dac96575fedfca270f48/a8a14/1590077909226.jpg 885w,\n/static/3e8786a8ec45dac96575fedfca270f48/fbd2c/1590077909226.jpg 1180w,\n/static/3e8786a8ec45dac96575fedfca270f48/5fe1b/1590077909226.jpg 1796w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>这是定义好的 project 类型。点击保存。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2e33b1cd867b99e19664a283daa08aa2/95e20/1590078117646.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHeUISL/8QAFxAAAwEAAAAAAAAAAAAAAAAAAQIQIP/aAAgBAQABBQKBcf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AUf/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAYEAEBAQEBAAAAAAAAAAAAAAABACExEf/aAAgBAQABPyE5JmQBu3DIW9v/2gAMAwEAAgADAAAAEGfP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAEDAQE/EKx//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EJGH/8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFhUcH/2gAIAQEAAT8QJCOQHpcpFVewT7HRgclirZb2f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi project content type\"\n        title=\"Strapi project content type\"\n        src=\"/static/2e33b1cd867b99e19664a283daa08aa2/1c72d/1590078117646.jpg\"\n        srcset=\"/static/2e33b1cd867b99e19664a283daa08aa2/a80bd/1590078117646.jpg 148w,\n/static/2e33b1cd867b99e19664a283daa08aa2/1c91a/1590078117646.jpg 295w,\n/static/2e33b1cd867b99e19664a283daa08aa2/1c72d/1590078117646.jpg 590w,\n/static/2e33b1cd867b99e19664a283daa08aa2/a8a14/1590078117646.jpg 885w,\n/static/2e33b1cd867b99e19664a283daa08aa2/fbd2c/1590078117646.jpg 1180w,\n/static/2e33b1cd867b99e19664a283daa08aa2/95e20/1590078117646.jpg 1644w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>然后我们接着创建几个用来测试的数据。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b836ac03cdbf65a8e46980b04a37049f/ee0d2/1590078824322.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd4EqJ//xAAXEAADAQAAAAAAAAAAAAAAAAABEBIg/9oACAEBAAEFAlIx/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAECAx/9oACAEBAAY/AhE//8QAGBAAAgMAAAAAAAAAAAAAAAAAEBEgYZH/2gAIAQEAAT8hQoZD/9oADAMBAAIAAwAAABCT/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QZH//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QbX//xAAcEAACAgIDAAAAAAAAAAAAAAABIQAREDFBUcH/2gAIAQEAAT8QFKAKjT56ht8UGs//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi test data\"\n        title=\"Strapi test data\"\n        src=\"/static/b836ac03cdbf65a8e46980b04a37049f/1c72d/1590078824322.jpg\"\n        srcset=\"/static/b836ac03cdbf65a8e46980b04a37049f/a80bd/1590078824322.jpg 148w,\n/static/b836ac03cdbf65a8e46980b04a37049f/1c91a/1590078824322.jpg 295w,\n/static/b836ac03cdbf65a8e46980b04a37049f/1c72d/1590078824322.jpg 590w,\n/static/b836ac03cdbf65a8e46980b04a37049f/a8a14/1590078824322.jpg 885w,\n/static/b836ac03cdbf65a8e46980b04a37049f/fbd2c/1590078824322.jpg 1180w,\n/static/b836ac03cdbf65a8e46980b04a37049f/ee0d2/1590078824322.jpg 2214w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>现在试试访问 <a href=\"http://localhost:1337/projects\">http://localhost:1337/projects</a></p>\n<p>hmm…报错了，403 Forbidden，无权访问接口。</p>\n<p>其实这是 Strapi 内建的 permission 系统，所有的接口是默认默认不开放给 public 的，要修改这个配置也很简单。去到 User - permission 页面，user 被默认分为两个角色，public 和 authenticated，这里我们暂时不接入用户系统，所以把 public 里面的接口权限开放即可。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2154bbdcd85501e54aa0033f0f7abc56/69019/1590079088648.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.513513513513516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABm+AH/8QAFhAAAwAAAAAAAAAAAAAAAAAABRAy/9oACAEBAAEFAh9r/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAAhBx/9oACAEBAAY/Ajj/AP/EABkQAAIDAQAAAAAAAAAAAAAAAAAhATGBsf/aAAgBAQABPyGF7Tppp//aAAwDAQACAAMAAAAQCA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8QNX//xAAaEAEAAQUAAAAAAAAAAAAAAAABABEhMUGR/9oACAEBAAE/EAQAJmgZSztyf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi user permission settings\"\n        title=\"Strapi user permission settings\"\n        src=\"/static/2154bbdcd85501e54aa0033f0f7abc56/1c72d/1590079088648.jpg\"\n        srcset=\"/static/2154bbdcd85501e54aa0033f0f7abc56/a80bd/1590079088648.jpg 148w,\n/static/2154bbdcd85501e54aa0033f0f7abc56/1c91a/1590079088648.jpg 295w,\n/static/2154bbdcd85501e54aa0033f0f7abc56/1c72d/1590079088648.jpg 590w,\n/static/2154bbdcd85501e54aa0033f0f7abc56/a8a14/1590079088648.jpg 885w,\n/static/2154bbdcd85501e54aa0033f0f7abc56/fbd2c/1590079088648.jpg 1180w,\n/static/2154bbdcd85501e54aa0033f0f7abc56/69019/1590079088648.jpg 1844w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>勾选上 releaselog 和 project 下面的<code class=\"language-text\">count</code>, <code class=\"language-text\">find</code>, <code class=\"language-text\">findone</code>的权限。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c232520498ef946112578dd2a549ec43/d14c1/1590079330782.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qhQf//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAAMBAQAAAAAAAAAAAAAAAAEQQQAh/9oACAEBAAE/IaeMaL//2gAMAwEAAgADAAAAEFMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBAAAgMAAwEAAAAAAAAAAAAAAAERITFBUWFx/9oACAEBAAE/EElJRvWnoiuzl9J9kXiP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi permission settings on api endpoint\"\n        title=\"Strapi permission settings on api endpoint\"\n        src=\"/static/c232520498ef946112578dd2a549ec43/1c72d/1590079330782.jpg\"\n        srcset=\"/static/c232520498ef946112578dd2a549ec43/a80bd/1590079330782.jpg 148w,\n/static/c232520498ef946112578dd2a549ec43/1c91a/1590079330782.jpg 295w,\n/static/c232520498ef946112578dd2a549ec43/1c72d/1590079330782.jpg 590w,\n/static/c232520498ef946112578dd2a549ec43/a8a14/1590079330782.jpg 885w,\n/static/c232520498ef946112578dd2a549ec43/fbd2c/1590079330782.jpg 1180w,\n/static/c232520498ef946112578dd2a549ec43/d14c1/1590079330782.jpg 1234w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>刷新 /projects，数据就可以正确显示出来了。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5e5b1cd0d051a505dc5d4495db56ae0/1250c/1590079258848.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.89189189189187%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAcABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAEEAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAH0G2mJuHNUoP/EABkQAAIDAQAAAAAAAAAAAAAAAAADARAUIP/aAAgBAQABBQLKoyJMaSbnr//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABoQAAICAwAAAAAAAAAAAAAAAAABMDIxkaH/2gAIAQEABj8Cw9lWV7F//8QAGxAAAwACAwAAAAAAAAAAAAAAAAERECFBYdH/2gAIAQEAAT8haXCU9DsDhDeIemTEVpFj/9oADAMBAAIAAwAAABBwygD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEAAgICAwEAAAAAAAAAAAABABEQMSGRQXGh8f/aAAgBAQABPxAb4V7zS+mfqoV5Kbns94CiVXMBd2dGFrDnUA0Y/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi rest api response\"\n        title=\"Strapi rest api response\"\n        src=\"/static/c5e5b1cd0d051a505dc5d4495db56ae0/1c72d/1590079258848.jpg\"\n        srcset=\"/static/c5e5b1cd0d051a505dc5d4495db56ae0/a80bd/1590079258848.jpg 148w,\n/static/c5e5b1cd0d051a505dc5d4495db56ae0/1c91a/1590079258848.jpg 295w,\n/static/c5e5b1cd0d051a505dc5d4495db56ae0/1c72d/1590079258848.jpg 590w,\n/static/c5e5b1cd0d051a505dc5d4495db56ae0/a8a14/1590079258848.jpg 885w,\n/static/c5e5b1cd0d051a505dc5d4495db56ae0/1250c/1590079258848.jpg 1178w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>这里也默认包含了 project 的「引用类型」releaselog 在 json 中，相同地，查询 releaselog 时，project 也会被查询出来，而且自带的 ORM 对查询做了优化，不会导致 N+1 的性能问题。</p>\n<h2>Swagger Doc</h2>\n<p>除了 API 接口是自动生成的，就连 swagger 文档都生成好了。在后台找到 marketplace（市场） 页面，安装 documentation 插件（顺便也可以把 GraphQL 的插件也安装了，后面会讲到）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/831b458ed96ee98d9330a98efd4e00eb/4658e/1590079563520.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHurCjhH//EABYQAQEBAAAAAAAAAAAAAAAAABECIP/aAAgBAQABBQLFJKf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAADAQEAAAAAAAAAAAAAAAAAAREhIP/aAAgBAQAGPwLjHDXT/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAERUXEQITFhkf/aAAgBAQABPyFp9+ixpvZLzlxJYmIP/9oADAMBAAIAAwAAABCP/wD/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QWHb/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QDWTG/8QAHhABAAIBBAMAAAAAAAAAAAAAAQARMSFBUYFxkbH/2gAIAQEAAT8QsKesJ3p3GPCnUsAbTV8ITULMmDxP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Strapi marketplace documentation\"\n        title=\"Strapi marketplace documentation\"\n        src=\"/static/831b458ed96ee98d9330a98efd4e00eb/1c72d/1590079563520.jpg\"\n        srcset=\"/static/831b458ed96ee98d9330a98efd4e00eb/a80bd/1590079563520.jpg 148w,\n/static/831b458ed96ee98d9330a98efd4e00eb/1c91a/1590079563520.jpg 295w,\n/static/831b458ed96ee98d9330a98efd4e00eb/1c72d/1590079563520.jpg 590w,\n/static/831b458ed96ee98d9330a98efd4e00eb/4658e/1590079563520.jpg 722w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>等待安装重启后，导航栏多了一个 doc 页面，点击 open doc 或者访问 <a href=\"http://localhost:1337/documentation/v1.0.0\">http://localhost:1337/documentation/v1.0.0</a> 就可以看到文档了。</p>\n<p>下一章接着介绍自动生成的 GraphQL API 部分。</p>","frontmatter":{"title":"使用 Strapi 和 GraphQL 快速搭建公司发布变更系统 —— Part.1 Strapi","date":"May 23, 2020","description":"软件开发的工作中不可避免的会遇到突发的生产环境事故，尤其是微服务架构下的今天，当一场事故发生后，如何快速定位到问题根源就极为重要。为了解决这个问题，我用 Strapi 构建了一套 GraphQL API，配合上 React.js，Typescript 和 GraphQL codegen 来快速构建一个发布变更系统 (release log system)。"}}},"pageContext":{"slug":"/build-a-release-system-with-strapi-and-graphql-part-1/","previous":null,"next":{"fields":{"slug":"/build-a-release-system-with-strapi-and-graphql-part-2/"},"frontmatter":{"title":"使用 Strapi 和 GraphQL 快速搭建公司发布变更系统 —— Part.2 GraphQL API"}}}},"staticQueryHashes":["1246554614","2841359383"]}