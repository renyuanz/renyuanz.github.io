{"componentChunkName":"component---src-templates-blog-post-js","path":"/build-a-release-system-with-strapi-and-graphql-part-2/","result":{"data":{"site":{"siteMetadata":{"title":"ryz"}},"markdownRemark":{"id":"16280371-758c-5c2c-b87a-6d0508e6aedc","excerpt":"GraphQL API 介绍完大家熟悉的 REST API 部分，重头戏来了。自动生成的还有 GraphQL API，GraphQL 是 Facebook 在 2015 年开源的数据查询和操作语言，相较于 REST 等其他 web service 架构提供了一种高效且灵活的 Web API 开发方案。 GraphQL…","html":"<h2>GraphQL API</h2>\n<p>介绍完大家熟悉的 REST API 部分，重头戏来了。自动生成的还有 GraphQL API，GraphQL 是 Facebook 在 2015 年开源的数据查询和操作语言，相较于 REST 等其他 web service 架构提供了一种高效且灵活的 Web API 开发方案。</p>\n<p>GraphQL 是声明式的（declarative），它与命令式编程不同的地方在于，你不用关心怎么拿到数据（How），而只用关心你要拿到什么数据（What）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/22908c0759f375f17c7d818a4022aa3d/93f30/1590160684655.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGQAAAQUAAAAAAAAAAAAAAAAAAAECAwQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAHaSBznYAL/AP/EABkQAAIDAQAAAAAAAAAAAAAAAAABAhAREv/aAAgBAQABBQK+mRb0/8QAFREBAQAAAAAAAAAAAAAAAAAAEBL/2gAIAQMBAT8Bo//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAABAx/9oACAEBAAY/Amv/xAAaEAACAwEBAAAAAAAAAAAAAAAAAREhMUHw/9oACAEBAAE/IW10yIEy/wA6NXYsP//aAAwDAQACAAMAAAAQR8//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8QCuT/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCH/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITFRcZGh/9oACAEBAAE/EMTxiWJUL5lhsiCy2weFSl+s0dT/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GraphQL is declarative\"\n        title=\"GraphQL is declarative\"\n        src=\"/static/22908c0759f375f17c7d818a4022aa3d/1c72d/1590160684655.jpg\"\n        srcset=\"/static/22908c0759f375f17c7d818a4022aa3d/a80bd/1590160684655.jpg 148w,\n/static/22908c0759f375f17c7d818a4022aa3d/1c91a/1590160684655.jpg 295w,\n/static/22908c0759f375f17c7d818a4022aa3d/1c72d/1590160684655.jpg 590w,\n/static/22908c0759f375f17c7d818a4022aa3d/a8a14/1590160684655.jpg 885w,\n/static/22908c0759f375f17c7d818a4022aa3d/fbd2c/1590160684655.jpg 1180w,\n/static/22908c0759f375f17c7d818a4022aa3d/93f30/1590160684655.jpg 1646w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>举个例子吧，如果要完成我草图中画的界面，能根据 project 来筛选 releaselogs，并且返回的 releaselog 里面要包含 <code class=\"language-text\">project</code> 和负责人 <code class=\"language-text\">user</code> 的数据。用 REST 的方式，我们会怎么做？</p>\n<p>我们会有一个接口请求一个<code class=\"language-text\">GET /releaselogs?project_id=1</code> 列表，在数据返回后，再请求 N 次<code class=\"language-text\">GET /users/:id</code>接口（或者用所有的 user id 组成一个列表去请求 <code class=\"language-text\">GET /users?ids=1,2,3</code> 接口）。</p>\n<p>但是通常我们会单独做一个接口，返回的 releaselogs 中加上 <code class=\"language-text\">project</code> 和 <code class=\"language-text\">user</code> 信息。</p>\n<p><strong>你看，REST 风格里，“接口”往往必须和“场景”耦合。</strong></p>\n<p>确认你在插件市场里已经安装好了 GraphQL 的插件。</p>\n<p>用 GraphQL 可以怎么做呢？打开 <a href=\"http://localhost:1337/graphql\">http://localhost:1337/graphql</a> ，这是一个 online editor，连 postman 都省了。在左边区域写一段 GraphQL 语句，运行，右边区域就可以看到返回的结果。</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">getReleases</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\"># 查询 project name 是 \"bar\" 的 releaselogs</span>\n  <span class=\"token property-query\">releaselogs</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">where</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">project</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"bar\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">id</span>\n    <span class=\"token property\">tag</span>\n    <span class=\"token property\">released_at</span>\n    <span class=\"token property\">release_notes</span>\n    <span class=\"token object\">project</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">id</span>\n      <span class=\"token property\">name</span>\n      <span class=\"token property\">maintainer_team</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token object\">approved_by</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">username</span>\n      <span class=\"token property\">email</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/deddecb58f922f30b7a5844042209056/139d6/1590161961741.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHHc3UIYf/EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAIDAQAAAAAAAAAAAAAAAAERABAxQf/aAAgBAQABPyExA8UQoZX/2gAMAwEAAgADAAAAEGw//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QJ//EABoQAAICAwAAAAAAAAAAAAAAAAERADEgIWH/2gAIAQEAAT8QJ2HEmBpoTkML/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GraphQL query example\"\n        title=\"GraphQL query example\"\n        src=\"/static/deddecb58f922f30b7a5844042209056/1c72d/1590161961741.jpg\"\n        srcset=\"/static/deddecb58f922f30b7a5844042209056/a80bd/1590161961741.jpg 148w,\n/static/deddecb58f922f30b7a5844042209056/1c91a/1590161961741.jpg 295w,\n/static/deddecb58f922f30b7a5844042209056/1c72d/1590161961741.jpg 590w,\n/static/deddecb58f922f30b7a5844042209056/a8a14/1590161961741.jpg 885w,\n/static/deddecb58f922f30b7a5844042209056/fbd2c/1590161961741.jpg 1180w,\n/static/deddecb58f922f30b7a5844042209056/139d6/1590161961741.jpg 2248w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>我相信大家可以很快的 get 到这样做的优点，虽然 REST 风格的接口也能做到这样的能力，但是我想要强调的并不是这种灵活的请求接口的能力，<strong>而是它描述数据的能力对开发者的心智模型来说是非常自然的。</strong></p>\n<p>而 strong type 强静态类型的特性使得它的工具链非常强大，除了语法检查、自动补全、编译时报错，配合 GraphQL codegen 更是能自动生成 React HOC / React Hooks / Vue composition functions，让你少写很多代码。</p>\n<p>The Best Code is No Code At All.</p>\n<h2>小结</h2>\n<p>至此大家已经了解了如何使用 Strapi 快速构建一套 API 接口（无论是 REST 风格还是 GraphQL API）。</p>\n<p>在我去年第一次接触到 Strapi 的时候真的是情不自禁地感叹到：WOW~ 希望这篇分享也会给你带来这种兴奋感。</p>\n<p>虽然 Strapi 还很年轻，但是已经有很多工业巨头在使用，包括 IBM 和法国兴业银行等。说明它的安全性、性能、开发效率都是得到了广泛认可的。</p>\n<p>示例项目的源码会和本文的下篇一起放出，欢迎关注哦~</p>","frontmatter":{"title":"使用 Strapi 和 GraphQL 快速搭建公司发布变更系统 —— Part.2 GraphQL API","date":"May 24, 2020","description":"使用 Strapi 不费吹灰之力地生成一个 Production ready 的 GraphQL Server。"}}},"pageContext":{"slug":"/build-a-release-system-with-strapi-and-graphql-part-2/","previous":{"fields":{"slug":"/build-a-release-system-with-strapi-and-graphql-part-1/"},"frontmatter":{"title":"使用 Strapi 和 GraphQL 快速搭建公司发布变更系统 —— Part.1 Strapi"}},"next":{"fields":{"slug":"/shopify-hydrogen/"},"frontmatter":{"title":"Shopify Hydrogen：为「动态电商」而生的新技术"}}}},"staticQueryHashes":["1246554614","2841359383"]}